local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

local screenGui = script.Parent
local mainFrame = screenGui:WaitForChild("MainFrame")
local titleBar = mainFrame:WaitForChild("TitleBar")
local closeButton = titleBar:WaitForChild("CloseButton")
local freezeButton = mainFrame:WaitForChild("ContentFrame"):WaitForChild("FreezeButton")
local unfreezeButton = mainFrame:WaitForChild("ContentFrame"):WaitForChild("UnfreezeButton")

-- RemoteEvent Reference
local tradeFreezeEvent = ReplicatedStorage:WaitForChild("TradeFreezeEvent")

local dragging = false
local dragStartPos = Vector2.new(0, 0)
local frameStartPos = UDim2.new(0, 0, 0, 0)

local function startDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStartPos = UserInputService:GetMouseLocation()
        frameStartPos = mainFrame.Position
    end
end

local function updateDrag(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local mousePos = UserInputService:GetMouseLocation()
        local delta = mousePos - dragStartPos
        
        local newX = frameStartPos.X.Offset + delta.X
        local newY = frameStartPos.Y.Offset + delta.Y
        
      
        local max_X = UserInputService.ViewportSize.X - mainFrame.AbsoluteSize.X
        local max_Y = UserInputService.ViewportSize.Y - mainFrame.AbsoluteSize.Y
        
        newX = math.clamp(newX, 0, max_X)
        newY = math.clamp(newY, 0, max_Y)
        
        mainFrame.Position = UDim2.new(0, newX, 0, newY)
    end
end

local function stopDrag(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end

titleBar.InputBegan:Connect(startDrag)
UserInputService.InputChanged:Connect(updateDrag)
UserInputService.InputEnded:Connect(stopDrag)


closeButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
end)


freezeButton.MouseButton1Click:Connect(function()
    print("LocalScript: Sending request to freeze trades...")
    tradeFreezeEvent:FireServer("freeze")
end)


unfreezeButton.MouseButton1Click:Connect(function()
    print("LocalScript: Sending request to unfreeze trades...")
    tradeFreezeEvent:FireServer("unfreeze")
end)
